<html>
  <head>
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="materialize/css/materialize.min.css"  media="screen,projection"/>

    <link type="text/css" rel="stylesheet" href="css/style.css"  media="screen,projection"/>
    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <link rel="icon" href="images/logo.png" type="image/png" sizes="16x16">
    <title>Index</title>


  </head>
  <body>
    <div class="row container">
      <div id="shoppingList1" class="card-panel large">
        <table id="shoppingTable1" class="centered">
          <thead>
            <tr>
              <th>Em falta:</th>
              <th>Receita médica:</th>
              <th>Preço:</th>
              <th>Detalhes:</th>
            </tr>
          </thead>
          <tbody id="pillsToShop">
            <tr>
              <td>
                <a class="btn-floating btn-medium waves-effect waves-light red modal-trigger" href="#shopForm1">
                  <i class="material-icons">add</i>
                </a>
              </td>
            </tr>
          </tbody>

        </table>
      </div>
      <div id="shoppingList2" class="card-panel large">
        <table id="shoppingTable2" class="centered">
          <thead>
            <tr>
              <th>Quase a acabar:</th>
              <th>Receita médica:</th>
              <th>Preço:</th>
              <th>Detalhes:</th>
            </tr>
          </thead>
          <tbody id="pillsRunningOut">

          </tbody>
        </table>
      </div>
      <div id="shopForm1" class="modal">
        <div class="modal-content">
          <form class="col s12">
            <div class="row">
              <b size=12>Preencha as informações necessárias(
                <span class="red-text text-darken-2">*</span>
                ) relativas ao comprimido a comprar:</b>
            </div>
            <div class="row">
              <div class="input-field col s3">
                <input placeholder="Nome" id="pillNameShop" type="text">
                <label for="pillName">Nome do comprimido:
                  <span class="red-text text-darken-2">*</span>
                </label>
              </div>
              <div class="input-field col s3">
                <input placeholder="Quantidade" id="pillAmountShop" type="text">
                <label for="pillAmount">Quantidade:
                  <span class="red-text text-darken-2">*</span>
                </label>
              </div>
              <div class="input-field col s3">
                <input placeholder="Preço" id="pillPriceShop" type="text">
                <label for="pillPrice">Preço:</label>
              </div>
            </div>
            <div class="row">Sujeito a receita médica?<span class="red-text text-darken-2">*</span>
              <form action="#">
                <p>
                  <label>
                    <input id="receiptShop" type="checkbox" class="filled-in" checked="unchecked"/>
                    <span>Sim</span>
                  </label>
                </p>
              </form>
              <!--<button class="btn waves-effect waves-light" type="submit" name="action">Concluído
                  <i class="material-icons right">send</i>
              </button>-->
            </div>
            <!--<button class="waves-effect grey-text text-darken-4" type="button" onclick="validateForm()">Entrar</button>-->
            <a class="modal-close btn waves-effect waves-light" onclick="validateShopForm1()">Concluído
              <i class="material-icons right">send</i>
            </a>

          </form>
        </div>
      </div>
      <div id="shopForm2" class="modal">
        <div class="modal-content">
          <form class="col s9">
            <div class="row">
              <b size=12>Quantidade comprada:</b>
            </div>
            <div class="row">
              <div class="input-field col s3">
                <input placeholder="Quantidade" id="pillAmountBought" type="text">
                <label for="pillAmountBought">Quantidade:
                  <span class="red-text text-darken-2">*</span>
                </label>
              </div>
              <a class="modal-close btn waves-effect waves-light" onclick="validateShopForm2()">Confirmar
                <i class="material-icons right">send</i>
              </a>

            </div>
          </form>
        </div>
      </div>
    </div>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.1/jquery.min.js"></script>
    <script type="text/javascript" src="materialize/js/materialize.min.js"></script>
    
    <script>
              $(document).ready(function () {
                $('.tabs').tabs();
                $('.dropdown-trigger').dropdown({
                  alignment: 'right',
                  constrainWidth: false,
                  coverTrigger: false
                });
                $('.modal').modal();
                $('select').formSelect();
                $('.timepicker').timepicker({twelveHour: false});
              });
    </script>

    <script>
      function validateShopForm1() {
        var pillName = document.getElementById("pillNameShop").value;
        var pillAmount = document.getElementById("pillAmountShop").value;
        console.log("ParseInt: " + parseInt(pillAmount));
        console.log("ParseFloat: " + parseFloat(pillAmount));
        var medicReceipt = document.getElementById("receiptShop").checked;
        console.log("Pill Name: " + pillName);
        console.log("Pill Amount: " + pillAmount);
        console.log("Receipt: " + medicReceipt);
        if (pillName == "" || pillAmount == "" || medicReceipt == null) {
          console.log("Gonna alert!");
          alert("Erro: informação necessária não preenchida.");
        } else if (!Number.isInteger(parseFloat(pillAmount))) {
          console.log("pillAmount not int")
          alert("Erro: quantidade de comprimidos deve ser número inteiro!");
        } else {
          console.log("Adding new Pill else!");
          var pillPrice = document.getElementById("pillPriceShop").value;
          if (isNaN(pillPrice)) {
            console.log("price not a number!");
            alert("Erro: preço dos comprimidos deve ser um número!");
          } else {
            console.log("addingNewPillTO SHopping list!")
            this.addNewShopPill(pillName, pillAmount, pillPrice, medicReceipt);
          }
        }
        this.cleanForm1();
      }

      function validateShopForm2() {
        console.log("FORM 2 CLOSED MODAL");
        //pillAmountBought
        var amountBought = document.getElementById("pillAmountBought").value;
        if (isNaN(amountBought)) {
          console.log("Amount bought not a number!");
          alert("Erro: quantidade comprada deve ser um número!");
        } else if (!Number.isInteger(parseFloat(amountBought))) {
          console.log("pillAmountBought not int");
          alert("Erro: quantidade comprada deve ser número inteiro!");
        } else {
          //add pills bought to stock
          this.deleteShopPill();
        }
        this.cleanForm2();
      }

      function cleanForm1() {
        document.getElementById("pillNameShop").value = "";
        document.getElementById("pillAmountShop").value = "";
        document.getElementById("receiptShop").checked = true;
        document.getElementById("pillPriceShop").value = "";
      }

      function cleanForm2() {
        document.getElementById("pillAmountBought").value = "";
      }

      function addNewShopPill(pillName, pillAmount, pillPrice, medicReceipt) {
        var shoppingList = document.getElementById("pillsToShop");
        console.log(shoppingList);
        var pillRow = document.createElement("tr");

        pillRow.setAttribute("pillName", pillName);
        console.log(pillRow);
        var pillCol1 = document.createElement("td");
        var pillCol2 = document.createElement("td");
        var pillCol3 = document.createElement("td");
        var pillCol4 = document.createElement("td");
        pillCol1.innerHTML = pillName;
        if (medicReceipt == false) {
          pillCol2.innerHTML = "Não";
        } else {
          pillCol2.innerHTML = "Sim";
        }
        console.log("Pill price: " + pillPrice);
        console.log(typeof (pillPrice));
        if (pillPrice == "") {
          pillCol3.innerHTML = "-";
        } else {
          pillCol3.innerHTML = pillPrice;
        }

        //row with buttons
        content = '<a class="btn-floating btn-small waves-effect waves-light green modal-trigger" href="#shopForm2" onclick="setParameterstoknowWhichPillTomorrow"><i class="material-icons">check</i></a>';
        content += '<a class="btn-floating btn-small waves-effect waves-light red" onclick="deleteShopPill(\'' + pillName + '\')"><i class="material-icons">clear</i></a>';
        content += '<a class="btn-floating btn-small waves-effect waves-light black modal-trigger" onclick="editShopPill()"><i class="material-icons">create</i></a>';
        pillCol4.innerHTML = content;

        pillRow.appendChild(pillCol1);
        pillRow.appendChild(pillCol2);
        pillRow.appendChild(pillCol3);
        pillRow.appendChild(pillCol4);

        shoppingList.insertBefore(pillRow, shoppingList.childNodes[0]);
      }

      function deleteShopPill(pillName) {
        console.log("Deleted Pill: " + pillName);
        var tableBody = document.getElementById("pillsToShop");
        var children = tableBody.childNodes;
        console.log(children);

        for (child in children) {
          var attributes = children[child].attributes;
          if (attributes != undefined) {
            var name = attributes["pillName"].nodeValue;
            if (name == pillName) {
              //console.log("FOUND GONNA DELETE NOW");
              tableBody.removeChild(children[child]);
              break;
            }
          }
        }
      }
    </script>

  </body>
</html>